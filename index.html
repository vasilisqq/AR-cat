<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <title>AR Experience</title>
    <script src="https://cdn.jsdelivr.net/gh/aframevr/aframe@1.4.2/dist/aframe-master.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        #desktop-message {
            display: none;
            text-align: center;
            padding: 50px;
        }
        #camera-container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        #screenshot-btn {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            padding: 15px 30px;
            background: rgba(0, 150, 255, 0.7);
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 18px;
            cursor: pointer;
        }
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div id="desktop-message">
        <h1>Пожалуйста, откройте это приложение на мобильном устройстве</h1>
        <p>Для работы с AR требуется камера телефона</p>
    </div>

    <div id="camera-container">
        <a-scene 
            vr-mode-ui="enabled: false"
            arjs="sourceType: webcam; trackingMethod: best; debugUIEnabled: false"
            renderer="logarithmicDepthBuffer: true;"
            embedded>

            <!-- Маркер для отслеживания поверхности -->
            <a-nft
                type="nft"
                url="https://arjs-cors-proxy.herokuapp.com/https://raw.githack.com/AR-js-org/AR.js/master/data/images/hiro"
                smooth="true"
                smoothCount="10"
                smoothTolerance="0.01"
                smoothThreshold="5">
                
                <!-- 3D модель с анимацией -->
                <a-entity 
                    gltf-model="models/cat_anim.glb"
                    scale="15 15 15"
                    position="0 -10 0"
                    animation-mixer="loop: repeat">
                </a-entity>
            </a-nft>
            <a-entity camera></a-entity>
        </a-scene>
        <button id="screenshot-btn">Сделать фото</button>
    </div>

    <script>
        // Проверка мобильного устройства
        function isMobile() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }

        // Элементы управления
        const desktopMessage = document.getElementById('desktop-message');
        const cameraContainer = document.getElementById('camera-container');
        const screenshotBtn = document.getElementById('screenshot-btn');

        // Показать сообщение для десктопа
        if (!isMobile()) {
            desktopMessage.style.display = 'block';
            cameraContainer.classList.add('hidden');
        } else {
            // Запрос разрешения на камеру
            navigator.mediaDevices.getUserMedia({ video: true })
                .catch(error => {
                    alert('Требуется доступ к камере!');
                    console.error('Camera error:', error);
                });
        }

        // Функция создания скриншота
        screenshotBtn.addEventListener('click', () => {
            const scene = document.querySelector('a-scene');
            scene.components.screenshot.capture('perspective')
                .then(data => {
                    // Создание временной ссылки для скачивания
                    const link = document.createElement('a');
                    link.href = data;
                    link.download = 'ar-photo.png';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                });
        });
    </script>
</body>
</html>